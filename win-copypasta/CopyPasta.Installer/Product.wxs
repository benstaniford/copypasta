<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <!-- Product Information -->
  <Product Id="*" 
           Name="CopyPasta" 
           Language="1033" 
           Version="1.0.0.0" 
           Manufacturer="CopyPasta Team" 
           UpgradeCode="12345678-1234-1234-1234-123456789012">
    
    <Package InstallerVersion="200" 
             Compressed="yes" 
             InstallScope="perMachine" 
             Description="CopyPasta - Cross-device clipboard sharing"
             Comments="Windows tray application for CopyPasta clipboard sync" />

    <!-- Media and Cab Information -->
    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
    <MediaTemplate EmbedCab="yes" />

    <!-- Feature Definition -->
    <Feature Id="ProductFeature" Title="CopyPasta" Level="1">
      <ComponentGroupRef Id="ProductComponents" />
      <ComponentRef Id="UserShortcuts" />
    </Feature>

    <!-- UI Configuration -->
    <UIRef Id="WixUI_InstallDir" />
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER" />
    
    <!-- License Agreement -->
    <WixVariable Id="WixUILicenseRtf" Value="License.rtf" />
    
    <!-- Application Icon -->
    <Icon Id="CopyPastaIcon" SourceFile="..\icon.ico" />
    <Property Id="ARPPRODUCTICON" Value="CopyPastaIcon" />
    
    <!-- Add/Remove Programs Information -->
    <Property Id="ARPHELPLINK" Value="https://github.com/anthropics/copypasta" />
    <Property Id="ARPURLINFOABOUT" Value="https://github.com/anthropics/copypasta" />
    <Property Id="ARPNOREPAIR" Value="1" />
  </Product>

  <!-- Directory Structure -->
  <Fragment>
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder">
        <Directory Id="INSTALLFOLDER" Name="CopyPasta" />
      </Directory>
      <Directory Id="ProgramMenuFolder">
        <Directory Id="ApplicationProgramsFolder" Name="CopyPasta" />
      </Directory>
      <Directory Id="DesktopFolder" Name="Desktop" />
    </Directory>
  </Fragment>

  <!-- Components -->
  <Fragment>
    <ComponentGroup Id="ProductComponents" Directory="INSTALLFOLDER">
      <!-- Main Application Files (per-machine) -->
      <Component Id="MainExecutable" Guid="11111111-1111-1111-1111-111111111111">
        <File Id="CopyPastaExe" 
              Source="$(var.CopyPasta.TargetDir)CopyPasta.exe" 
              KeyPath="yes" 
              Checksum="yes" />
      </Component>
      
      <!-- Runtime Configuration -->
      <Component Id="RuntimeConfig" Guid="22222222-2222-2222-2222-222222222222">
        <File Id="RuntimeConfigJson" 
              Source="$(var.CopyPasta.TargetDir)CopyPasta.runtimeconfig.json" 
              KeyPath="yes" />
      </Component>
      
      <!-- Dependencies -->
      <Component Id="Dependencies" Guid="33333333-3333-3333-3333-333333333333">
        <File Id="NewtonsoftJson" 
              Source="$(var.CopyPasta.TargetDir)Newtonsoft.Json.dll" 
              KeyPath="yes" />
      </Component>
      
      <!-- Application Icon -->
      <Component Id="ApplicationIcon" Guid="44444444-4444-4444-4444-444444444444">
        <File Id="IconFile" 
              Source="..\icon.ico" 
              KeyPath="yes" />
      </Component>
    </ComponentGroup>

    <!-- Per-user shortcuts and settings -->
    <Component Id="UserShortcuts" Directory="INSTALLFOLDER" Guid="55555555-5555-5555-5555-555555555555">
      <!-- Start Menu Shortcut -->
      <Shortcut Id="ApplicationStartMenuShortcut"
                Directory="ApplicationProgramsFolder"
                Name="CopyPasta"
                Description="Cross-device clipboard sharing"
                Target="[INSTALLFOLDER]CopyPasta.exe"
                WorkingDirectory="INSTALLFOLDER"
                Icon="CopyPastaIcon" />
      
      <!-- Desktop Shortcut -->
      <Shortcut Id="ApplicationDesktopShortcut"
                Directory="DesktopFolder"
                Name="CopyPasta"
                Description="Cross-device clipboard sharing"
                Target="[INSTALLFOLDER]CopyPasta.exe"
                WorkingDirectory="INSTALLFOLDER"
                Icon="CopyPastaIcon" />
      
      <!-- Auto-start registry entry -->
      <RegistryValue Root="HKCU"
                     Key="SOFTWARE\Microsoft\Windows\CurrentVersion\Run"
                     Name="CopyPasta"
                     Value="&quot;[INSTALLFOLDER]CopyPasta.exe&quot;"
                     Type="string" />
      
      <!-- Registry key as KeyPath for per-user component -->
      <RegistryValue Root="HKCU" 
                     Key="Software\CopyPasta" 
                     Name="Installed" 
                     Type="integer" 
                     Value="1" 
                     KeyPath="yes" />
      
      <!-- Remove folder on uninstall -->
      <RemoveFolder Id="ApplicationProgramsFolder" Directory="ApplicationProgramsFolder" On="uninstall" />
    </Component>
  </Fragment>
</Wix>